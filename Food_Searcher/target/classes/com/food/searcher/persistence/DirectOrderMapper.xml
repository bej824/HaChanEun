<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.food.searcher.persistence.DirectOrderMapper">
	<resultMap type="com.food.searcher.domain.DirectOrderVO" id="orderResultMap">
		<id property="orderId" column="ORDER_ID" />
		<result property="memberId" column="MEMBER_ID" />
		<result property="totalPrice" column="TOTAL_PRICE" />
		<result property="deliveryAddress" column="DELIVERY_ADDRESS" />
		<result property="deliveryStatus" column="DELIVERY_STATUS" />
		<result property="deliveryDate" column="DELIVERY_DATE" />
		<result property="itemId" column="ITEM_ID" />
		<result property="totalCount" column="TOTAL_COUNT" />
		<result property="deliveryCompletedDate" column="DELIVERY_COMPLETED_DATE" />
	</resultMap>
	
	<insert id="insert">
	    INSERT INTO DIRECT_ORDER(
	        ORDER_ID,
	        MEMBER_ID,
	        ITEM_ID,
	        TOTAL_COUNT,
	        TOTAL_PRICE,
	        DELIVERY_ADDRESS
	    ) VALUES (
	        ORDER_SEQ.NEXTVAL, 
	        #{memberId}, 
	        #{itemId},
	        #{totalCount},
	        #{totalPrice}, 
	        #{deliveryAddress}
	    )
	</insert>
	
	<select id="selectAll" resultMap="orderResultMap">
		SELECT * FROM DIRECT_ORDER ORDER BY ORDER_ID DESC
	</select>
	
	<select id="selectOne" resultMap="orderResultMap">
		SELECT * FROM DIRECT_ORDER d
		JOIN ITEM i ON d.ITEM_ID = i.ITEM_ID
		WHERE ORDER_ID = #{orderId}
	</select>
	
	<select id="selectMember" resultMap="orderResultMap">
		SELECT * FROM DIRECT_ORDER WHERE MEMBER_ID = #{memberId}
	</select>
	
	<update id="changeStatus">
		UPDATE DIRECT_ORDER SET DELIVERY_STATUS = #{deliveryStatus}
	</update>

</mapper>